<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.minyisoft.webapp.yjmz.common.persistence.SecurityDao" >
    
    <!-- 为指定组织架构所有用户增加指定角色 -->
    <insert id="insertOrgUserRole" >
      insert into t_common_user_role (fid,fuserid,forgid,froleid) 
      (select sys_guid(),fid,#{org.id},#{role.id} from t_common_user where fid in (select fuserid from t_common_user_org where forgid=#{org.id}))
    </insert>

    <!-- 删除指定组织架构所有用户的所有角色 -->
    <delete id="deleteOrgUserAllRoles">
      delete from t_common_user_role where forgid=#{org.id}
    </delete>

    <!-- 删除指定组织架构所有用户的指定角色 -->
    <delete id="deleteOrgUserRoles">
      delete from t_common_user_role 
      where forgid=#{org.id} and froleid in <foreach collection="roles" item="item" open="(" close=")" separator=",">#{item.id}</foreach>
    </delete>

    <!-- 删除指定用户的所有角色 -->
    <delete id="deleteUserRoles" parameterType="UserInfo" >
      delete from t_common_user_role where fuserid = #{id}
    </delete>
    
    <!-- 删除指定用户在指定组织的所有角色 -->
    <delete id="deleteUserOrgRoles">
      delete from t_common_user_role where fuserid = #{user.id} and forgid = #{org.id}
    </delete>

    <!-- 为指定用户增加指定角色 -->
    <insert id="insertUserRole">
      insert into t_common_user_role (fid,fuserid,forgid,froleid) values(sys_guid(),#{user.id},#{org.id},#{role.id})
    </insert>
</mapper>